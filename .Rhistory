usethis::use_testthat()
source('~/Desktop/truncNormalMoments/R/functions.R')
devtools::test()
source('~/Desktop/truncNormalMoments/R/functions.R')
source('~/Desktop/truncNormalMoments/R/functions.R')
test_that("Cumulants evaluated at point matches analytical expression.", {
expect_equal(get_cumulants("mm", m, s, ul, uh, n), -(n/s**2) + (n/s**2) * ((alphah(m, s, ul, uh) - alphal(m, s, ul, uh)) ** 2 + alphah(m, s, ul, uh) * ush(m, s, ul, uh) - alphal(m, s, ul, uh) * usl(m, s, ul, uh)))
expect_equal(get_cumulants("ms", m, s, ul, uh, n), (-2 * n/s**3) * Ex_min_m(m,s,ul,uh) + (n/s**2) * (alphal(m, s, ul, uh) - alphah(m, s, ul, uh) + alphah(m, s, ul, uh) * ush(m, s, ul, uh) **2 - alphal(m, s, ul, uh) * usl(m, s, ul, uh)**2 + (alphal(m, s, ul, uh) - alphah(m, s, ul, uh)) * (alphal(m, s, ul, uh)*usl(m, s, ul, uh) - alphah(m, s, ul, uh) * ush(m, s, ul, uh)) ))
})
source('~/Desktop/truncNormalMoments/R/functions.R')
source('~/Desktop/truncNormalMoments/R/functions.R')
source('~/Desktop/truncNormalMoments/R/functions.R')
source('~/Desktop/truncNormalMoments/R/functions.R')
source('~/Desktop/truncNormalMoments/R/functions.R')
source('~/Desktop/truncNormalMoments/R/functions.R')
source('~/Desktop/truncNormalMoments/R/functions.R')
source('~/Desktop/truncNormalMoments/R/functions.R')
source('~/Desktop/truncNormalMoments/R/functions.R')
data.60 <- weather[weather$year <= 1970 & weather$year >= 1961 ,]
weather <- as.data.frame(read.csv("simplified-sfo-weather.csv"))
weather["sinf"] <- sin((2 * pi/ 365) * (weather["day"] - 1))
weather["cosf"] <- cos((2 * pi/ 365) * (weather["day"] - 1))
weather.bf90s <- weather[weather$year <= 1990,]
line <- lm(temphigh ~ sinf + cosf, na.action=na.omit, data=weather)
print(summary(line))
data.60 <- weather[weather$year <= 1970 & weather$year >= 1961 ,]
data.70 <- weather[weather$year <= 1980 & weather$year >= 1971,]
data.80 <- weather[weather$year <= 1990 & weather$year >= 1981,]
data.90 <- weather[weather$year <= 2000 & weather$year >= 1991,]
data.00 <- weather[weather$year <= 2010 & weather$year >= 2001,]
data.10 <- weather[weather$year <= 2020 & weather$year >= 2011,]
print(data.60)
data.60 <- weather[weather$year <= 1970 & weather$year >= 1961 ,]
data.70 <- weather[weather$year <= 1980 & weather$year >= 1971,]
data.80 <- weather[weather$year <= 1990 & weather$year >= 1981,]
data.90 <- weather[weather$year <= 2000 & weather$year >= 1991,]
data.00 <- weather[weather$year <= 2010 & weather$year >= 2001,]
data.10 <- weather[weather$year <= 2020 & weather$year >= 2011,]
print(data.90)
data.60 <- weather[weather$year <= 1970 & weather$year >= 1961 ,]
data.70 <- weather[weather$year <= 1980 & weather$year >= 1971,]
data.80 <- weather[weather$year <= 1990 & weather$year >= 1981,]
data.90 <- weather[weather$year <= 2000 & weather$year >= 1991,]
data.00 <- weather[weather$year <= 2010 & weather$year >= 2001,]
data.10 <- weather[weather$year <= 2020 & weather$year >= 2011,]
pred.60 <- predict(line, data.60, na.action=na.omit)
pred.70 <- predict(line, data.70, na.action=na.omit)
pred.80 <- predict(line, data.80, na.action=na.omit)
pred.90 <- predict(line, data.90, na.action=na.omit)
pred.00 <- predict(line, data.00, na.action=na.omit)
pred.10 <- predict(line, data.10, na.action=na.omit)
data.60 <- na.omit(weather[weather$year <= 1970 & weather$year >= 1961 ,])
data.70 <- na.omit(weather[weather$year <= 1980 & weather$year >= 1971,])
data.80 <- na.omit(weather[weather$year <= 1990 & weather$year >= 1981,])
data.90 <- na.omit(weather[weather$year <= 2000 & weather$year >= 1991,])
data.00 <- na.omit(weather[weather$year <= 2010 & weather$year >= 2001,])
data.10 <- na.omit(weather[weather$year <= 2020 & weather$year >= 2011,])
pred.60 <- predict(line, data.60, na.action=na.omit)
pred.70 <- predict(line, data.70, na.action=na.omit)
pred.80 <- predict(line, data.80, na.action=na.omit)
pred.90 <- predict(line, data.90, na.action=na.omit)
pred.00 <- predict(line, data.00, na.action=na.omit)
pred.10 <- predict(line, data.10, na.action=na.omit)
print(mean(data.60["hightemp"]))
data.60 <- na.omit(weather[weather$year <= 1970 & weather$year >= 1961 ,])
data.70 <- na.omit(weather[weather$year <= 1980 & weather$year >= 1971,])
data.80 <- na.omit(weather[weather$year <= 1990 & weather$year >= 1981,])
data.90 <- na.omit(weather[weather$year <= 2000 & weather$year >= 1991,])
data.00 <- na.omit(weather[weather$year <= 2010 & weather$year >= 2001,])
data.10 <- na.omit(weather[weather$year <= 2020 & weather$year >= 2011,])
pred.60 <- predict(line, data.60, na.action=na.omit)
pred.70 <- predict(line, data.70, na.action=na.omit)
pred.80 <- predict(line, data.80, na.action=na.omit)
pred.90 <- predict(line, data.90, na.action=na.omit)
pred.00 <- predict(line, data.00, na.action=na.omit)
pred.10 <- predict(line, data.10, na.action=na.omit)
print(mean(data.60["high_temp"]))
weather <- as.data.frame(read.csv("simplified-sfo-weather.csv"))
weather["sinf"] <- sin((2 * pi/ 365) * (weather["day"] - 1))
weather["cosf"] <- cos((2 * pi/ 365) * (weather["day"] - 1))
weather.bf90s <- weather[weather$year <= 1990,]
line <- lm(temphigh ~ sinf + cosf, na.action=na.omit, data=weather)
#print(summary(line))
print(weather)
data.60 <- na.omit(weather[weather$year <= 1970 & weather$year >= 1961 ,])
data.70 <- na.omit(weather[weather$year <= 1980 & weather$year >= 1971,])
data.80 <- na.omit(weather[weather$year <= 1990 & weather$year >= 1981,])
data.90 <- na.omit(weather[weather$year <= 2000 & weather$year >= 1991,])
data.00 <- na.omit(weather[weather$year <= 2010 & weather$year >= 2001,])
data.10 <- na.omit(weather[weather$year <= 2020 & weather$year >= 2011,])
pred.60 <- predict(line, data.60, na.action=na.omit)
pred.70 <- predict(line, data.70, na.action=na.omit)
pred.80 <- predict(line, data.80, na.action=na.omit)
pred.90 <- predict(line, data.90, na.action=na.omit)
pred.00 <- predict(line, data.00, na.action=na.omit)
pred.10 <- predict(line, data.10, na.action=na.omit)
print(mean(data.60["temphigh"]))
data.60 <- na.omit(weather[weather$year <= 1970 & weather$year >= 1961 ,])
data.70 <- na.omit(weather[weather$year <= 1980 & weather$year >= 1971,])
data.80 <- na.omit(weather[weather$year <= 1990 & weather$year >= 1981,])
data.90 <- na.omit(weather[weather$year <= 2000 & weather$year >= 1991,])
data.00 <- na.omit(weather[weather$year <= 2010 & weather$year >= 2001,])
data.10 <- na.omit(weather[weather$year <= 2020 & weather$year >= 2011,])
pred.60 <- predict(line, data.60, na.action=na.omit)
pred.70 <- predict(line, data.70, na.action=na.omit)
pred.80 <- predict(line, data.80, na.action=na.omit)
pred.90 <- predict(line, data.90, na.action=na.omit)
pred.00 <- predict(line, data.00, na.action=na.omit)
pred.10 <- predict(line, data.10, na.action=na.omit)
print(data.60["temphigh"])
data.60 <- na.omit(weather[weather$year <= 1970 & weather$year >= 1961 ,])
data.70 <- na.omit(weather[weather$year <= 1980 & weather$year >= 1971,])
data.80 <- na.omit(weather[weather$year <= 1990 & weather$year >= 1981,])
data.90 <- na.omit(weather[weather$year <= 2000 & weather$year >= 1991,])
data.00 <- na.omit(weather[weather$year <= 2010 & weather$year >= 2001,])
data.10 <- na.omit(weather[weather$year <= 2020 & weather$year >= 2011,])
pred.60 <- predict(line, data.60, na.action=na.omit)
pred.70 <- predict(line, data.70, na.action=na.omit)
pred.80 <- predict(line, data.80, na.action=na.omit)
pred.90 <- predict(line, data.90, na.action=na.omit)
pred.00 <- predict(line, data.00, na.action=na.omit)
pred.10 <- predict(line, data.10, na.action=na.omit)
print(data.60["temphigh"] - pred.60)
data.60 <- na.omit(weather[weather$year <= 1970 & weather$year >= 1961 ,])
data.70 <- na.omit(weather[weather$year <= 1980 & weather$year >= 1971,])
data.80 <- na.omit(weather[weather$year <= 1990 & weather$year >= 1981,])
data.90 <- na.omit(weather[weather$year <= 2000 & weather$year >= 1991,])
data.00 <- na.omit(weather[weather$year <= 2010 & weather$year >= 2001,])
data.10 <- na.omit(weather[weather$year <= 2020 & weather$year >= 2011,])
pred.60 <- predict(line, data.60, na.action=na.omit)
pred.70 <- predict(line, data.70, na.action=na.omit)
pred.80 <- predict(line, data.80, na.action=na.omit)
pred.90 <- predict(line, data.90, na.action=na.omit)
pred.00 <- predict(line, data.00, na.action=na.omit)
pred.10 <- predict(line, data.10, na.action=na.omit)
print(mean(data.60["temphigh"] - pred.60))
weather <- as.data.frame(read.csv("simplified-sfo-weather.csv"))
weather["sinf"] <- sin((2 * pi/ 365) * (weather["day"] - 1))
weather["cosf"] <- cos((2 * pi/ 365) * (weather["day"] - 1))
weather.bf90s <- weather[weather$year <= 1990,]
line <- lm(temphigh ~ sinf + cosf, na.action=na.omit, data=weather)
#print(summary(line))
data.60 <- na.omit(weather[weather$year <= 1970 & weather$year >= 1961 ,])
data.70 <- na.omit(weather[weather$year <= 1980 & weather$year >= 1971,])
data.80 <- na.omit(weather[weather$year <= 1990 & weather$year >= 1981,])
data.90 <- na.omit(weather[weather$year <= 2000 & weather$year >= 1991,])
data.00 <- na.omit(weather[weather$year <= 2010 & weather$year >= 2001,])
data.10 <- na.omit(weather[weather$year <= 2020 & weather$year >= 2011,])
pred.60 <- predict(line, data.60, na.action=na.omit)
pred.70 <- predict(line, data.70, na.action=na.omit)
pred.80 <- predict(line, data.80, na.action=na.omit)
pred.90 <- predict(line, data.90, na.action=na.omit)
pred.00 <- predict(line, data.00, na.action=na.omit)
pred.10 <- predict(line, data.10, na.action=na.omit)
mean(data.60["temphigh"] - pred.60)
data.60 <- na.omit(weather[weather$year <= 1970 & weather$year >= 1961 ,])
data.70 <- na.omit(weather[weather$year <= 1980 & weather$year >= 1971,])
data.80 <- na.omit(weather[weather$year <= 1990 & weather$year >= 1981,])
data.90 <- na.omit(weather[weather$year <= 2000 & weather$year >= 1991,])
data.00 <- na.omit(weather[weather$year <= 2010 & weather$year >= 2001,])
data.10 <- na.omit(weather[weather$year <= 2020 & weather$year >= 2011,])
pred.60 <- predict(line, data.60, na.action=na.omit)
pred.70 <- predict(line, data.70, na.action=na.omit)
pred.80 <- predict(line, data.80, na.action=na.omit)
pred.90 <- predict(line, data.90, na.action=na.omit)
pred.00 <- predict(line, data.00, na.action=na.omit)
pred.10 <- predict(line, data.10, na.action=na.omit)
mean(data.60["temphigh"] - pred.60["temphigh"])
data.60 <- na.omit(weather[weather$year <= 1970 & weather$year >= 1961 ,])
data.70 <- na.omit(weather[weather$year <= 1980 & weather$year >= 1971,])
data.80 <- na.omit(weather[weather$year <= 1990 & weather$year >= 1981,])
data.90 <- na.omit(weather[weather$year <= 2000 & weather$year >= 1991,])
data.00 <- na.omit(weather[weather$year <= 2010 & weather$year >= 2001,])
data.10 <- na.omit(weather[weather$year <= 2020 & weather$year >= 2011,])
pred.60 <- predict(line, data.60, na.action=na.omit)
pred.70 <- predict(line, data.70, na.action=na.omit)
pred.80 <- predict(line, data.80, na.action=na.omit)
pred.90 <- predict(line, data.90, na.action=na.omit)
pred.00 <- predict(line, data.00, na.action=na.omit)
pred.10 <- predict(line, data.10, na.action=na.omit)
print(mean(data.60["temphigh"] - pred.60["temphigh"]))
data.60 <- na.omit(weather[weather$year <= 1970 & weather$year >= 1961 ,])
data.70 <- na.omit(weather[weather$year <= 1980 & weather$year >= 1971,])
data.80 <- na.omit(weather[weather$year <= 1990 & weather$year >= 1981,])
data.90 <- na.omit(weather[weather$year <= 2000 & weather$year >= 1991,])
data.00 <- na.omit(weather[weather$year <= 2010 & weather$year >= 2001,])
data.10 <- na.omit(weather[weather$year <= 2020 & weather$year >= 2011,])
pred.60 <- predict(line, data.60, na.action=na.omit)
pred.70 <- predict(line, data.70, na.action=na.omit)
pred.80 <- predict(line, data.80, na.action=na.omit)
pred.90 <- predict(line, data.90, na.action=na.omit)
pred.00 <- predict(line, data.00, na.action=na.omit)
pred.10 <- predict(line, data.10, na.action=na.omit)
print(mean((data.60["temphigh"] - pred.60)["temphigh"]))
data.60 <- na.omit(weather[weather$year <= 1970 & weather$year >= 1961 ,])
data.70 <- na.omit(weather[weather$year <= 1980 & weather$year >= 1971,])
data.80 <- na.omit(weather[weather$year <= 1990 & weather$year >= 1981,])
data.90 <- na.omit(weather[weather$year <= 2000 & weather$year >= 1991,])
data.00 <- na.omit(weather[weather$year <= 2010 & weather$year >= 2001,])
data.10 <- na.omit(weather[weather$year <= 2020 & weather$year >= 2011,])
pred.60 <- predict(line, data.60, na.action=na.omit)
pred.70 <- predict(line, data.70, na.action=na.omit)
pred.80 <- predict(line, data.80, na.action=na.omit)
pred.90 <- predict(line, data.90, na.action=na.omit)
pred.00 <- predict(line, data.00, na.action=na.omit)
pred.10 <- predict(line, data.10, na.action=na.omit)
print(mean((data.60["temphigh"] - pred.60)$temphigh))
data.60 <- na.omit(weather[weather$year <= 1970 & weather$year >= 1961 ,])
data.70 <- na.omit(weather[weather$year <= 1980 & weather$year >= 1971,])
data.80 <- na.omit(weather[weather$year <= 1990 & weather$year >= 1981,])
data.90 <- na.omit(weather[weather$year <= 2000 & weather$year >= 1991,])
data.00 <- na.omit(weather[weather$year <= 2010 & weather$year >= 2001,])
data.10 <- na.omit(weather[weather$year <= 2020 & weather$year >= 2011,])
pred.60 <- predict(line, data.60, na.action=na.omit)
pred.70 <- predict(line, data.70, na.action=na.omit)
pred.80 <- predict(line, data.80, na.action=na.omit)
pred.90 <- predict(line, data.90, na.action=na.omit)
pred.00 <- predict(line, data.00, na.action=na.omit)
pred.10 <- predict(line, data.10, na.action=na.omit)
print(mean((data.60["temphigh"] - pred.60)$temphigh))
print(mean((data.70["temphigh"] - pred.70)$temphigh))
print(mean((data.80["temphigh"] - pred.80)$temphigh))
print(mean((data.90["temphigh"] - pred.90)$temphigh))
print(mean((data.00["temphigh"] - pred.00)$temphigh))
print(mean((data.10["temphigh"] - pred.10)$temphigh))
data.60 <- na.omit(weather[weather$year <= 1970 & weather$year >= 1961 ,])
data.70 <- na.omit(weather[weather$year <= 1980 & weather$year >= 1971,])
data.80 <- na.omit(weather[weather$year <= 1990 & weather$year >= 1981,])
data.90 <- na.omit(weather[weather$year <= 2000 & weather$year >= 1991,])
data.00 <- na.omit(weather[weather$year <= 2010 & weather$year >= 2001,])
data.10 <- na.omit(weather[weather$year <= 2020 & weather$year >= 2011,])
pred.60 <- predict(line, data.60, na.action=na.omit)
pred.70 <- predict(line, data.70, na.action=na.omit)
pred.80 <- predict(line, data.80, na.action=na.omit)
pred.90 <- predict(line, data.90, na.action=na.omit)
pred.00 <- predict(line, data.00, na.action=na.omit)
pred.10 <- predict(line, data.10, na.action=na.omit)
print(paste0("60's average difference: ", mean((data.60["temphigh"] - pred.60)$temphigh)))
print(mean((data.70["temphigh"] - pred.70)$temphigh))
print(mean((data.80["temphigh"] - pred.80)$temphigh))
print(mean((data.90["temphigh"] - pred.90)$temphigh))
print(mean((data.00["temphigh"] - pred.00)$temphigh))
print(mean((data.10["temphigh"] - pred.10)$temphigh))
data.60 <- na.omit(weather[weather$year <= 1970 & weather$year >= 1961 ,])
data.70 <- na.omit(weather[weather$year <= 1980 & weather$year >= 1971,])
data.80 <- na.omit(weather[weather$year <= 1990 & weather$year >= 1981,])
data.90 <- na.omit(weather[weather$year <= 2000 & weather$year >= 1991,])
data.00 <- na.omit(weather[weather$year <= 2010 & weather$year >= 2001,])
data.10 <- na.omit(weather[weather$year <= 2020 & weather$year >= 2011,])
pred.60 <- predict(line, data.60, na.action=na.omit)
pred.70 <- predict(line, data.70, na.action=na.omit)
pred.80 <- predict(line, data.80, na.action=na.omit)
pred.90 <- predict(line, data.90, na.action=na.omit)
pred.00 <- predict(line, data.00, na.action=na.omit)
pred.10 <- predict(line, data.10, na.action=na.omit)
print(paste0("60's average difference: ", mean((data.60["temphigh"] - pred.60)$temphigh)))
print(paste0("70's average difference: ", mean((data.70["temphigh"] - pred.70)$temphigh)))
print(paste0("80's average difference: ", mean((data.80["temphigh"] - pred.80)$temphigh)))
print(paste0("90's average difference: ", mean((data.90["temphigh"] - pred.90)$temphigh)))
print(paste0("00's average difference: ", mean((data.00["temphigh"] - pred.00)$temphigh)))
print(paste0("10's average difference: ", mean((data.10["temphigh"] - pred.10)$temphigh)))
library(testthat)
library(rstan)
library(Deriv)
library(truncnorm)
library(testit)
library(devtools)
check()
library(testthat)
library(rstan)
library(Deriv)
library(truncnorm)
library(testit)
install.packages("devtools")
install.packages("devtools")
library(devtools)
check()
check()
check()
check()
library(testthat)
library(rstan)
######## DEFINING VARIABLES #########
n <- 20
m <- 1.2
s <- 8
ul <- 0
uh <- 3
x <- c(0.385258397941442, 1.68066267127739, 0.729227742032434, 0.479120432291688,
0.897279068695914, 0.0575356881970433, 0.165652783807015, 0.875647820475464,
0.380168104717168, 0.825551957468494, 0.589842597791253, 0.402854395794205,
1.7668857263465, 0.649703054651576, 0.83074621395, 0.407612065235468,
1.49884534475478, 0.420770708293162, 0.699931456061883, 1.06188921169992)
model.text <- "
functions{
real jeffreys_prior(real mu, real sigma, real a, real b, int n){
real mustarL;
real mustarU;
real alphaL;
real alphaU;
real kmm;
real kms;
real kss;
matrix[2,2] fishinfo;
mustarL = (a - mu) / sigma;
mustarU = (b - mu) / sigma;
// note that normal_lpdf, etc., parameterize in terms of SD, not var
//  the (0,1) below are *not* start values for MCMC
alphaL = exp( normal_lpdf(mustarL | 0, 1) -
log_diff_exp( normal_lcdf(mustarU | 0, 1),
normal_lcdf(mustarL | 0, 1) ) );
alphaU = exp( normal_lpdf(mustarU | 0, 1) -
log_diff_exp( normal_lcdf(mustarU | 0, 1),
normal_lcdf(mustarL | 0, 1) ) );
// second derivatives for Fisher info
kmm = -n/sigma^2 + n/sigma^2 * ((alphaU-alphaL)^2 + alphaU*mustarU- alphaL*mustarL);
kms = -2*n/sigma^2 * (alphaL - alphaU) +
n/sigma^2 * (alphaL - alphaU + (alphaU*mustarU^2 - alphaL*mustarL^2) +
(alphaL-alphaU) * (alphaL*mustarL - alphaU*mustarU));
kss = n/sigma^2 - 3*n/sigma^2 * (1 + mustarL*alphaL - mustarU*alphaU) +
n/sigma^2 * (mustarU*alphaU*(mustarU^2 - 2) - mustarL*alphaL*(mustarL^2 - 2) +
(alphaU*mustarU - alphaL*mustarL)^2);
fishinfo[1,1] = -kmm;
fishinfo[1,2] = -kms;
fishinfo[2,1] = -kms;
fishinfo[2,2] = -kss;
return sqrt(determinant(fishinfo));
}
}
data{
int<lower=0> n;
real a;
real b;
real<lower=a,upper=b> y[n];
}
parameters{
real mu;
real<lower=0> sigma;
}
model{
target += log( jeffreys_prior(mu, sigma, a, b, n) );
for(i in 1:n)
y[i] ~ normal(mu, sigma)T[a,b];
}
generated quantities{
real log_lik;
real log_prior = log(jeffreys_prior(mu, sigma, a, b, n));
real log_post;
log_lik = normal_lpdf(y | mu, sigma);
log_lik += -n * log_diff_exp( normal_lcdf(b | mu, sigma), normal_lcdf(a | mu, sigma) );
log_post = log_lik + log_prior;
}
"
l.lim <- 0.025
r.lim <- 0.975
stan.model <- stan_model(model_code = model.text,
isystem = "~/Desktop")
post <- sampling(stan.model, data = list( n = length(x), a = ul, b = uh, y = x, iters=100))
